{{- $questionnairesSection := site.GetPage "questionnaires" }}
{{- $questionnaire := $questionnairesSection.GetPage .questionnaireId }}
{{- $scales := slice }}
{{- $items := slice }}
{{- $options := slice }}

{{- range $pageIndex, $page := $questionnaire.Pages }}
  {{- $items = $items | append $page.RenderShortcodes}}
  {{- if eq $pageIndex 0 }}
    {{- $options = $options | append (slice .Params.options) }}
  {{- else }}
    {{- $options = $options | append .Params.options }}
  {{- end }}
{{- end }}

{{ with $questionnaire.Resources.Get "specs.json" }}
  {{- $questionnaireSpecs := . | unmarshal }}
  {{- range $scaleId, $scale := $questionnaireSpecs.scales }}
    {{- $scales = $scales | append (dict "scaleId" $scaleId "code" $scale.code "name" $scale.name "order" $scale.order ) }}
  {{- end }}
{{ end }}

{{ return dict
    "scales" (sort $scales "order" "asc")
    "items" $items
    "options" $options
}}