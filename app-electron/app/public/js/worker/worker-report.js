(()=>{var y=r=>{let e=r.slice().sort((o,s)=>o-s),n=Math.floor(e.length/2);return e.length%2!==0?e[n]:(e[n-1]+e[n])/2},w=onmessage=async({data:r})=>{importScripts(r.urls.urlScoringScript,r.urls.urlTemplatingScript);let{testee:e,session:n,questionnaire:{questionnaireId:o,answers:s},urls:{urlReportTemplate:u,urlQuestionnaireSpecs:p}}=r,i=Object.keys(s),m=i.map(t=>s[t].answerLatency),g=y(m);i.forEach(t=>{s[t].deltaAnswerLatency=s[t].answerLatency-g});let[h,c]=await Promise.all([fetch(u).then(t=>t.text()),fetch(p).then(t=>t.json())]),a=Object.keys(c?.scales||[]).length>0,l=a?computeScores({testee:e,session:n,answers:s,specs:c}):{},S=a?eval?.(`"use strict";${c.norms.getNormsBiblio};fn(${JSON.stringify({...e,...n})})`):{},f=generateReport({testee:e,session:n,answers:s,scores:l,normsBiblio:{ref:S},template:h});postMessage({questionnaireId:o,questionnaireScores:l,questionnaireAnswers:s,questionnaireReport:f})};})();
